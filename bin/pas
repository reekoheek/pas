#!/usr/bin/env node

'use strict';

const _ = require('lodash');
const argv = require('minimist')(process.argv.slice(2));
const opts = _.pick(argv, (value, key) => key !== '_');
const id = argv._[0];
const args = argv._.slice(1);
const bundle = require('../lib/bundle');
const cfg = require('../lib/config')();
const co = require('co');
const colors = require('colors');

colors.setTheme({
  silly: 'rainbow',
  input: 'grey',
  verbose: 'cyan',
  prompt: 'grey',
  info: 'green',
  data: 'grey',
  help: 'cyan',
  warn: 'yellow',
  debug: 'blue',
  error: 'red'
});

co(function *() {
  try {
    yield bundle(cfg)
      .args(args)
      .opts(opts)
      .run(id);
    console.log('');
  } catch(e) {
    console.error('*** %s\nPlease report this to maintainer\n%s'.red, e.message, e.stack);
  }
});
